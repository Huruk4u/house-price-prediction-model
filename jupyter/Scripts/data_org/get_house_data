{"cells":[{"cell_type":"code","execution_count":null,"metadata":{"id":"tPBWpE0_SF4P"},"outputs":[],"source":["# 패키지 import 구간\n","import json\n","import requests\n","import pandas as pd\n","import xml.etree.ElementTree as ET\n","import requests\n","import datetime\n","import math\n","\n","from bs4 import BeautifulSoup as BS\n","from google.colab import drive\n","\n","from geopy.geocoders import Nominatim"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":129947,"status":"ok","timestamp":1700810313196,"user":{"displayName":"seongmin Yoo","userId":"09462757910056720462"},"user_tz":-540},"id":"NYS1KomlPHKh","outputId":"72d0108a-4e9b-484e-f5fb-2d8dc5863bbb"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}],"source":["drive.mount('/content/drive')\n","google_maps_API = \"\" # input api key"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"dahnktf0iQkV"},"outputs":[],"source":["### 함수 정의 구간\n","\n","# 데이터 업로드\n","def upload_data(file_name):\n","  rtn = pd.read_csv(file_name, encoding = 'utf-8')\n","  rtn = pd.DataFrame(rtn)\n","\n","  return rtn\n","\n","# response 생성, parameter = (구 단위의 법정동코드, 요청 기간(월))\n","def get_response(gu_code, base_date):\n","    url =\"http://openapi.molit.go.kr:8081/OpenAPI_ToolInstallPackage/service/rest/RTMSOBJSvc/getRTMSDataSvcAptTrade?\"\n","    serviceKey = \"\" # input serviceKey\n","    # 쿼리 생성 후, 요청 수령\n","    payload = \"LAWD_CD=\" + gu_code + \"&\" + \\\n","              \"DEAL_YMD=\" + base_date + \"&\" + \\\n","              \"serviceKey=\" + serviceKey + \"&\"\n","    res = requests.get(url + payload)\n","\n","    return res\n","\n","\n","# 요청 사항을 item_list로 전환\n","def get_items(response):\n","    root = ET.fromstring(response.content)\n","    item_list = []\n","    for child in root.find('body').find('items'):\n","        elements = child.findall('*')\n","        data = {}\n","        for element in elements:\n","            tag = element.tag.strip()\n","            text = element.text.strip()\n","            # print tag, text\n","            data[tag] = text\n","        item_list.append(data)\n","    return item_list\n","\n","\n","# 기간 단위로 아이템 추출\n","def get_period_item(base_date_list, gu_code):\n","  rtn = []\n","  for base_date in base_date_list:\n","    res = get_response(gu_code, base_date)\n","    rtn += get_items(res)\n","\n","  return rtn\n","\n","\n","# Google Map api 위도, 경도 추출 함수\n","def get_lat_lng(address, api_key):\n","    # 쿼리\n","    endpoint = f'https://maps.googleapis.com/maps/api/geocode/json?address={address}&key={api_key}'\n","    # 요청 수령 및 json포맷으로 변환\n","    response = requests.get(endpoint)\n","    data = response.json()\n","    if data['status'] == 'OK':\n","        lat = data['results'][0]['geometry']['location']['lat']\n","        lng = data['results'][0]['geometry']['location']['lng']\n","        return lat, lng\n","    else:\n","        return None, None\n","\n","\n","# 지번 주소를 기반으로 위도 경도 추출\n","def getLocList(addlist):\n","  latitude = []\n","  longitude = []\n","\n","  for i in addlist:\n","    lat, lng = get_lat_lng(i, google_maps_API)\n","    latitude.append(lat)\n","    longitude.append(lng)\n","\n","  loc = pd.DataFrame({'위도' : latitude, '경도' : longitude})\n","\n","  return loc\n","\n","def haversine_distance(lat1, lon1, lat2, lon2):\n","  # 위도와 경도를 라디안으로 변환\n","  lat1, lon1, lat2, lon2 = map(math.radians, [lat1, lon1, lat2, lon2])\n","\n","  # Haversine 공식 계산\n","  dlon = lon2 - lon1\n","  dlat = lat2 - lat1\n","  a = math.sin(dlat/2)**2 + math.cos(lat1) * math.cos(lat2) * math.sin(dlon/2)**2\n","  c = 2 * math.atan2(math.sqrt(a), math.sqrt(1-a))\n","  # 지구 반지름 (킬로미터)\n","  radius = 6371\n","  # 두 지점 간의 거리 계산 (킬로미터)\n","  distance = radius * c\n","  return distance"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"VKEmKZk8San7"},"outputs":[],"source":["manan_code = '41171' # 안양시 만안구의 법정동 코드\n","dongan_code = '41173' # 안양시 동안구의 법정동 코드\n","suwon_code = \"4111\" # 수원시의 법정동 코드\n","\n","# 22년도 6월부터 23년도 9월까지의 데이터 추출\n","base_date_list = [\"202206\", \"202207\", \"202208\", \"202209\", \"202210\", \"202211\", \"202212\", \"202301\", \"202302\", \"202303\", \"202304\", \"202305\", \"202306\", \"202307\", \"202308\", \"202309\"]\n","\n","\n","# 만안구 데이터 프레임 추출\n","MananDF = get_period_item(base_date_list, manan_code)\n","MananDF = pd.DataFrame(MananDF)\n","\n","\n","# 동안구 데이터 프레임 추출\n","DonganDF = get_period_item(base_date_list, dongan_code)\n","DonganDF = pd.DataFrame(DonganDF)"]},{"cell_type":"code","source":["MananDF"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":424},"id":"zbD27BmEMfyL","executionInfo":{"status":"ok","timestamp":1700810364082,"user_tz":-540,"elapsed":448,"user":{"displayName":"seongmin Yoo","userId":"09462757910056720462"}},"outputId":"e9c31743-d76a-4065-b806-072874f05bc5"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["        거래금액  거래유형  건축년도     년 등기일자  법정동         아파트  월   일     전용면적  \\\n","0     44,300  중개거래  2016  2022       안양동  래미안안양메가트리아  6   1     39.5   \n","1     44,500  중개거래  2016  2022       안양동  래미안안양메가트리아  6   1     39.5   \n","2     42,000  중개거래  2016  2022       안양동  래미안안양메가트리아  6   2     39.5   \n","3     30,500  중개거래  2008  2022       안양동       세양청마루  6   2     56.7   \n","4     44,700  중개거래  2000  2022       안양동        율목주공  6   2    59.89   \n","...      ...   ...   ...   ...  ...  ...         ... ..  ..      ...   \n","1246  34,500  중개거래  1986  2023       박달동          신한  9  22    60.48   \n","1247  85,000  중개거래  2000  2023       박달동       한라비발디  9  23  175.236   \n","1248  60,000  중개거래  1996  2023       박달동          벽산  9  23  101.965   \n","1249  48,000  중개거래  2009  2023       박달동    한신휴플러스3차  9  23  59.8406   \n","1250  42,000  중개거래  1990  2023       박달동          우성  9  25    72.94   \n","\n","                중개사소재지     지번   지역코드   층   해제사유발생일 해제여부  \n","0             경기 안양만안구   1393  41171  20                 \n","1             경기 안양만안구   1393  41171  13                 \n","2             경기 안양만안구   1393  41171  19                 \n","3             경기 안양만안구  435-9  41171  16                 \n","4     경기 안양만안구, 서울 송파구  969-1  41171   6                 \n","...                ...    ...    ...  ..       ...  ...  \n","1246          경기 안양만안구  111-1  41171   1  23.10.06    O  \n","1247  경기 광명시, 경기 안양만안구    114  41171  11                 \n","1248          경기 안양만안구    107  41171  15                 \n","1249          경기 안양만안구     37  41171  11                 \n","1250          경기 안양만안구     85  41171   4                 \n","\n","[1251 rows x 16 columns]"],"text/html":["\n","  <div id=\"df-1e5df3c9-e9f0-4e5e-a3f5-f858fc86806d\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>거래금액</th>\n","      <th>거래유형</th>\n","      <th>건축년도</th>\n","      <th>년</th>\n","      <th>등기일자</th>\n","      <th>법정동</th>\n","      <th>아파트</th>\n","      <th>월</th>\n","      <th>일</th>\n","      <th>전용면적</th>\n","      <th>중개사소재지</th>\n","      <th>지번</th>\n","      <th>지역코드</th>\n","      <th>층</th>\n","      <th>해제사유발생일</th>\n","      <th>해제여부</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>44,300</td>\n","      <td>중개거래</td>\n","      <td>2016</td>\n","      <td>2022</td>\n","      <td></td>\n","      <td>안양동</td>\n","      <td>래미안안양메가트리아</td>\n","      <td>6</td>\n","      <td>1</td>\n","      <td>39.5</td>\n","      <td>경기 안양만안구</td>\n","      <td>1393</td>\n","      <td>41171</td>\n","      <td>20</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>44,500</td>\n","      <td>중개거래</td>\n","      <td>2016</td>\n","      <td>2022</td>\n","      <td></td>\n","      <td>안양동</td>\n","      <td>래미안안양메가트리아</td>\n","      <td>6</td>\n","      <td>1</td>\n","      <td>39.5</td>\n","      <td>경기 안양만안구</td>\n","      <td>1393</td>\n","      <td>41171</td>\n","      <td>13</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>42,000</td>\n","      <td>중개거래</td>\n","      <td>2016</td>\n","      <td>2022</td>\n","      <td></td>\n","      <td>안양동</td>\n","      <td>래미안안양메가트리아</td>\n","      <td>6</td>\n","      <td>2</td>\n","      <td>39.5</td>\n","      <td>경기 안양만안구</td>\n","      <td>1393</td>\n","      <td>41171</td>\n","      <td>19</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>30,500</td>\n","      <td>중개거래</td>\n","      <td>2008</td>\n","      <td>2022</td>\n","      <td></td>\n","      <td>안양동</td>\n","      <td>세양청마루</td>\n","      <td>6</td>\n","      <td>2</td>\n","      <td>56.7</td>\n","      <td>경기 안양만안구</td>\n","      <td>435-9</td>\n","      <td>41171</td>\n","      <td>16</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>44,700</td>\n","      <td>중개거래</td>\n","      <td>2000</td>\n","      <td>2022</td>\n","      <td></td>\n","      <td>안양동</td>\n","      <td>율목주공</td>\n","      <td>6</td>\n","      <td>2</td>\n","      <td>59.89</td>\n","      <td>경기 안양만안구, 서울 송파구</td>\n","      <td>969-1</td>\n","      <td>41171</td>\n","      <td>6</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>1246</th>\n","      <td>34,500</td>\n","      <td>중개거래</td>\n","      <td>1986</td>\n","      <td>2023</td>\n","      <td></td>\n","      <td>박달동</td>\n","      <td>신한</td>\n","      <td>9</td>\n","      <td>22</td>\n","      <td>60.48</td>\n","      <td>경기 안양만안구</td>\n","      <td>111-1</td>\n","      <td>41171</td>\n","      <td>1</td>\n","      <td>23.10.06</td>\n","      <td>O</td>\n","    </tr>\n","    <tr>\n","      <th>1247</th>\n","      <td>85,000</td>\n","      <td>중개거래</td>\n","      <td>2000</td>\n","      <td>2023</td>\n","      <td></td>\n","      <td>박달동</td>\n","      <td>한라비발디</td>\n","      <td>9</td>\n","      <td>23</td>\n","      <td>175.236</td>\n","      <td>경기 광명시, 경기 안양만안구</td>\n","      <td>114</td>\n","      <td>41171</td>\n","      <td>11</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>1248</th>\n","      <td>60,000</td>\n","      <td>중개거래</td>\n","      <td>1996</td>\n","      <td>2023</td>\n","      <td></td>\n","      <td>박달동</td>\n","      <td>벽산</td>\n","      <td>9</td>\n","      <td>23</td>\n","      <td>101.965</td>\n","      <td>경기 안양만안구</td>\n","      <td>107</td>\n","      <td>41171</td>\n","      <td>15</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>1249</th>\n","      <td>48,000</td>\n","      <td>중개거래</td>\n","      <td>2009</td>\n","      <td>2023</td>\n","      <td></td>\n","      <td>박달동</td>\n","      <td>한신휴플러스3차</td>\n","      <td>9</td>\n","      <td>23</td>\n","      <td>59.8406</td>\n","      <td>경기 안양만안구</td>\n","      <td>37</td>\n","      <td>41171</td>\n","      <td>11</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>1250</th>\n","      <td>42,000</td>\n","      <td>중개거래</td>\n","      <td>1990</td>\n","      <td>2023</td>\n","      <td></td>\n","      <td>박달동</td>\n","      <td>우성</td>\n","      <td>9</td>\n","      <td>25</td>\n","      <td>72.94</td>\n","      <td>경기 안양만안구</td>\n","      <td>85</td>\n","      <td>41171</td>\n","      <td>4</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>1251 rows × 16 columns</p>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-1e5df3c9-e9f0-4e5e-a3f5-f858fc86806d')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-1e5df3c9-e9f0-4e5e-a3f5-f858fc86806d button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-1e5df3c9-e9f0-4e5e-a3f5-f858fc86806d');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","<div id=\"df-fcb0c995-53ed-48f2-bc10-b9c0ef5e418d\">\n","  <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-fcb0c995-53ed-48f2-bc10-b9c0ef5e418d')\"\n","            title=\"Suggest charts\"\n","            style=\"display:none;\">\n","\n","<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","     width=\"24px\">\n","    <g>\n","        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n","    </g>\n","</svg>\n","  </button>\n","\n","<style>\n","  .colab-df-quickchart {\n","      --bg-color: #E8F0FE;\n","      --fill-color: #1967D2;\n","      --hover-bg-color: #E2EBFA;\n","      --hover-fill-color: #174EA6;\n","      --disabled-fill-color: #AAA;\n","      --disabled-bg-color: #DDD;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart {\n","      --bg-color: #3B4455;\n","      --fill-color: #D2E3FC;\n","      --hover-bg-color: #434B5C;\n","      --hover-fill-color: #FFFFFF;\n","      --disabled-bg-color: #3B4455;\n","      --disabled-fill-color: #666;\n","  }\n","\n","  .colab-df-quickchart {\n","    background-color: var(--bg-color);\n","    border: none;\n","    border-radius: 50%;\n","    cursor: pointer;\n","    display: none;\n","    fill: var(--fill-color);\n","    height: 32px;\n","    padding: 0;\n","    width: 32px;\n","  }\n","\n","  .colab-df-quickchart:hover {\n","    background-color: var(--hover-bg-color);\n","    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n","    fill: var(--button-hover-fill-color);\n","  }\n","\n","  .colab-df-quickchart-complete:disabled,\n","  .colab-df-quickchart-complete:disabled:hover {\n","    background-color: var(--disabled-bg-color);\n","    fill: var(--disabled-fill-color);\n","    box-shadow: none;\n","  }\n","\n","  .colab-df-spinner {\n","    border: 2px solid var(--fill-color);\n","    border-color: transparent;\n","    border-bottom-color: var(--fill-color);\n","    animation:\n","      spin 1s steps(1) infinite;\n","  }\n","\n","  @keyframes spin {\n","    0% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","      border-left-color: var(--fill-color);\n","    }\n","    20% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    30% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","      border-right-color: var(--fill-color);\n","    }\n","    40% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    60% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","    }\n","    80% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-bottom-color: var(--fill-color);\n","    }\n","    90% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","    }\n","  }\n","</style>\n","\n","  <script>\n","    async function quickchart(key) {\n","      const quickchartButtonEl =\n","        document.querySelector('#' + key + ' button');\n","      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n","      quickchartButtonEl.classList.add('colab-df-spinner');\n","      try {\n","        const charts = await google.colab.kernel.invokeFunction(\n","            'suggestCharts', [key], {});\n","      } catch (error) {\n","        console.error('Error during call to suggestCharts:', error);\n","      }\n","      quickchartButtonEl.classList.remove('colab-df-spinner');\n","      quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n","    }\n","    (() => {\n","      let quickchartButtonEl =\n","        document.querySelector('#df-fcb0c995-53ed-48f2-bc10-b9c0ef5e418d button');\n","      quickchartButtonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","    })();\n","  </script>\n","</div>\n","    </div>\n","  </div>\n"]},"metadata":{},"execution_count":5}]},{"cell_type":"code","source":["# 계절지수로 아파트 매매가를 나눌려면 거래일자 column이 필요할거 같아서 추출할 거임\n","MananDF['거래일자'] = pd.to_datetime(MananDF[['년', '월', '일']].astype(str).agg('-'.join, axis=1), format='%Y-%m-%d')\n","MananDF.drop(columns=['년', '월', '일'], inplace=True)\n","\n","DonganDF['거래일자'] = pd.to_datetime(DonganDF[['년', '월', '일']].astype(str).agg('-'.join, axis=1), format='%Y-%m-%d')\n","DonganDF.drop(columns=['년', '월', '일'], inplace=True)\n"],"metadata":{"id":"n3kiKfqBwIBt"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# 수원시 데이터 프레임 추출\n","GwonsunCode = \"41113\" # 수원시 권선구 법정동코드\n","YeongtongCode = \"41117\" # 수원시 팔달구 법정동코드\n","JanganCode = \"41111\" # 수원시 장안구 법정동코드\n","PaldalCode = \"41115\" # 수원시 팔달구 법정동코드\n","\n","# 약 2000개\n","GwonsunData = get_period_item(base_date_list, GwonsunCode)\n","GwonsunDF = pd.DataFrame(GwonsunData)\n","GwonsunDF['거래일자'] = pd.to_datetime(GwonsunDF[['년', '월', '일']].astype(str).agg('-'.join, axis=1), format='%Y-%m-%d')\n","GwonsunDF.drop(columns=['년', '월', '일'], inplace=True)\n","\n","# 약 4500개\n","YeongtongData = get_period_item(base_date_list, YeongtongCode)\n","YeongtongDF = pd.DataFrame(YeongtongData)\n","YeongtongDF['거래일자'] = pd.to_datetime(YeongtongDF[['년', '월', '일']].astype(str).agg('-'.join, axis=1), format='%Y-%m-%d')\n","YeongtongDF.drop(columns=['년', '월', '일'], inplace=True)\n","\n","# 약 1100개\n","JanganData = get_period_item(base_date_list, JanganCode)\n","JanganDF = pd.DataFrame(JanganData)\n","JanganDF['거래일자'] = pd.to_datetime(JanganDF[['년', '월', '일']].astype(str).agg('-'.join, axis=1), format='%Y-%m-%d')\n","JanganDF.drop(columns=['년', '월', '일'], inplace=True)\n","\n","PaldalData = get_period_item(base_date_list, PaldalCode)\n","PaldalDF = pd.DataFrame(PaldalData)\n","PaldalDF['거래일자'] = pd.to_datetime(PaldalDF[['년', '월', '일']].astype(str).agg('-'.join, axis=1), format='%Y-%m-%d')\n","PaldalDF.drop(columns=['년', '월', '일'], inplace=True)"],"metadata":{"id":"HjtlkUxo1x9q"},"execution_count":null,"outputs":[]},{"cell_type":"code","execution_count":null,"metadata":{"id":"c65-45QSUkIj"},"outputs":[],"source":["MananDF = MananDF[['거래금액', '거래일자', '건축년도', '법정동', '아파트', '전용면적', '지번', '지역코드', '층']]\n","DonganDF = DonganDF[['거래금액', '거래일자', '건축년도', '법정동', '아파트', '전용면적', '지번', '지역코드', '층']]\n","\n","# 지역 데이터에서 번지 수 데이터 새로 생성\n","# 여러 개의 열을 병합하여 번지 주소 데이터로 정리한다.\n","MananAdd = \"경기 안양시 만안구 \" + MananDF['법정동'] + \" \" + MananDF['지번']\n","DonganAdd = \"경기 안양시 동안구 \" + DonganDF['법정동'] + \" \" + DonganDF['지번']\n","\n","# 만안구의 지번 주소를 넣고, 위도 경도 데이터 프레임 추출\n","MananLocation = getLocList(MananAdd)\n","DonganLocation = getLocList(DonganAdd)\n","\n","# 추출한 위도, 경도 데이터프레임을 기존의 데이터 프레임과 합침\n","MananLocation = pd.merge(MananDF, MananLocation, left_index=True, right_index=True, how='inner')\n","MananDF = pd.merge(MananLocation, pd.DataFrame(MananAdd), left_index=True, right_index=True, how='inner')\n","\n","DonganLocation = pd.merge(DonganDF, DonganLocation, left_index=True, right_index=True, how='inner')\n","DonganDF = pd.merge(DonganLocation, pd.DataFrame(DonganAdd), left_index=True, right_index=True, how='inner')\n","\n","# 추출한 데이터 저장\n","MananDF.to_csv('만안구2206_2309.csv', index=False, encoding='utf-8-sig')\n","DonganDF.to_csv('동안구2206_2309.csv', index=False, encoding='utf-8-sig')"]},{"cell_type":"code","source":["exList = ['거래금액', '거래일자', '건축년도', '법정동', '아파트', '전용면적', '지번', '지역코드', '층']\n","\n","# 필요한 데이터 컬럼만 추출\n","GwonsunDF = GwonsunDF[exList]\n","YeongtongDF = YeongtongDF[exList]\n","JanganDF = JanganDF[exList]\n","PaldalDF = PaldalDF[exList]\n","\n","# 수원시 번지 주소 데이터 정리\n","GwonsunAdd = \"경기 수원시 권선구 \" + GwonsunDF['법정동'] + \" \" + GwonsunDF['지번']\n","YeongtongAdd = \"경기 수원시 영통구 \" + YeongtongDF['법정동'] + \" \" + YeongtongDF['지번']\n","JanganAdd = \"경기 수원시 장안구 \" + JanganDF['법정동'] + \" \" + JanganDF['지번']\n","PaldalAdd = \"경기 수원시 팔달구 \" + PaldalDF['법정동'] + \" \" + PaldalDF['지번']\n","\n","# 구 지번 주소 넣고, 위도 경도 데이터 프레임 추출\n","GwonsunLoc = getLocList(GwonsunAdd)\n","YeongtongLoc = getLocList(YeongtongAdd)\n","JanganLoc = getLocList(JanganAdd)\n","PaldalLoc = getLocList(PaldalAdd)\n","\n","# 데이터 최종 병합\n","GwonsunLoc = pd.merge(GwonsunDF, GwonsunLoc, left_index=True, right_index=True, how='inner')\n","GwonsunDF = pd.merge(GwonsunLoc, pd.DataFrame(GwonsunAdd), left_index=True, right_index=True, how='inner')\n","\n","YeongtongLoc = pd.merge(YeongtongDF, YeongtongLoc, left_index=True, right_index=True, how='inner')\n","YeongtongDF = pd.merge(YeongtongLoc, pd.DataFrame(YeongtongAdd), left_index=True, right_index=True, how='inner')\n","\n","JanganLoc = pd.merge(JanganDF, JanganLoc, left_index=True, right_index=True, how='inner')\n","JanganDF = pd.merge(JanganLoc, pd.DataFrame(JanganAdd), left_index=True, right_index=True, how='inner')\n","\n","PaldalLoc = pd.merge(PaldalDF, PaldalLoc, left_index=True, right_index=True, how='inner')\n","PaldalDF = pd.merge(PaldalLoc, pd.DataFrame(PaldalAdd), left_index=True, right_index=True, how='inner')\n","\n","# 추출한 데이터 저장\n","GwonsunDF.to_csv('권선구2206_2309.csv', index=False, encoding='utf-8-sig')\n","YeongtongDF.to_csv('영통구2206_2309.csv', index=False, encoding='utf-8-sig')\n","JanganDF.to_csv('장안구2206_2309.csv', index=False, encoding='utf-8-sig')\n","PaldalDF.to_csv('팔달구2206_2309.csv', index=False, encoding='utf-8-sig')"],"metadata":{"id":"J7tmnDRY5oYP"},"execution_count":null,"outputs":[]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":424},"executionInfo":{"elapsed":3,"status":"ok","timestamp":1699951932072,"user":{"displayName":"seongmin Yoo","userId":"09462757910056720462"},"user_tz":-540},"id":"4H40Oje1PXQE","outputId":"eb1140e0-2896-4d97-a957-aec649cfb1fe"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["        거래금액  건축년도  법정동        아파트      전용면적     지번   지역코드   층         위도  \\\n","0     74,500  2002  매탄동     우남퍼스트빌   101.945   1274  41117  14  37.257835   \n","1     93,000  2008  매탄동    매탄위브하늘채   128.821   1352  41117  15  37.261819   \n","2     67,800  1993  매탄동        한국2     72.84   1217  41117   5  37.267460   \n","3     39,000  1989  매탄동         동남     49.68  810-2  41117   6  37.266921   \n","4     51,500  1989  매탄동        삼성2     84.87    810  41117  10  37.269525   \n","...      ...   ...  ...        ...       ...    ...    ...  ..        ...   \n","4467  57,000  2002  망포동  망포현대2아이파크  101.9522    683  41117  13  37.240117   \n","4468  40,000  2000  망포동      늘푸른벽산    59.884    488  41117  19  37.239931   \n","4469  49,700  2002  망포동  망포현대2아이파크   84.9945    683  41117   2  37.240117   \n","4470  96,000  2017  망포동    힐스테이트영통   84.8897    728  41117  21  37.243348   \n","4471  59,000  2003  망포동    엘지동수원자이  110.5997    698  41117   1  37.236696   \n","\n","              경도                     0  \n","0     127.043222   경기 수원시 영통구 매탄동 1274  \n","1     127.041410   경기 수원시 영통구 매탄동 1352  \n","2     127.051119   경기 수원시 영통구 매탄동 1217  \n","3     127.042984  경기 수원시 영통구 매탄동 810-2  \n","4     127.043632    경기 수원시 영통구 매탄동 810  \n","...          ...                   ...  \n","4467  127.051035    경기 수원시 영통구 망포동 683  \n","4468  127.060739    경기 수원시 영통구 망포동 488  \n","4469  127.051035    경기 수원시 영통구 망포동 683  \n","4470  127.048732    경기 수원시 영통구 망포동 728  \n","4471  127.056533    경기 수원시 영통구 망포동 698  \n","\n","[4472 rows x 11 columns]"],"text/html":["\n","  <div id=\"df-1178b92d-d381-40c4-9c07-75ebd64590f9\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>거래금액</th>\n","      <th>건축년도</th>\n","      <th>법정동</th>\n","      <th>아파트</th>\n","      <th>전용면적</th>\n","      <th>지번</th>\n","      <th>지역코드</th>\n","      <th>층</th>\n","      <th>위도</th>\n","      <th>경도</th>\n","      <th>0</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>74,500</td>\n","      <td>2002</td>\n","      <td>매탄동</td>\n","      <td>우남퍼스트빌</td>\n","      <td>101.945</td>\n","      <td>1274</td>\n","      <td>41117</td>\n","      <td>14</td>\n","      <td>37.257835</td>\n","      <td>127.043222</td>\n","      <td>경기 수원시 영통구 매탄동 1274</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>93,000</td>\n","      <td>2008</td>\n","      <td>매탄동</td>\n","      <td>매탄위브하늘채</td>\n","      <td>128.821</td>\n","      <td>1352</td>\n","      <td>41117</td>\n","      <td>15</td>\n","      <td>37.261819</td>\n","      <td>127.041410</td>\n","      <td>경기 수원시 영통구 매탄동 1352</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>67,800</td>\n","      <td>1993</td>\n","      <td>매탄동</td>\n","      <td>한국2</td>\n","      <td>72.84</td>\n","      <td>1217</td>\n","      <td>41117</td>\n","      <td>5</td>\n","      <td>37.267460</td>\n","      <td>127.051119</td>\n","      <td>경기 수원시 영통구 매탄동 1217</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>39,000</td>\n","      <td>1989</td>\n","      <td>매탄동</td>\n","      <td>동남</td>\n","      <td>49.68</td>\n","      <td>810-2</td>\n","      <td>41117</td>\n","      <td>6</td>\n","      <td>37.266921</td>\n","      <td>127.042984</td>\n","      <td>경기 수원시 영통구 매탄동 810-2</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>51,500</td>\n","      <td>1989</td>\n","      <td>매탄동</td>\n","      <td>삼성2</td>\n","      <td>84.87</td>\n","      <td>810</td>\n","      <td>41117</td>\n","      <td>10</td>\n","      <td>37.269525</td>\n","      <td>127.043632</td>\n","      <td>경기 수원시 영통구 매탄동 810</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>4467</th>\n","      <td>57,000</td>\n","      <td>2002</td>\n","      <td>망포동</td>\n","      <td>망포현대2아이파크</td>\n","      <td>101.9522</td>\n","      <td>683</td>\n","      <td>41117</td>\n","      <td>13</td>\n","      <td>37.240117</td>\n","      <td>127.051035</td>\n","      <td>경기 수원시 영통구 망포동 683</td>\n","    </tr>\n","    <tr>\n","      <th>4468</th>\n","      <td>40,000</td>\n","      <td>2000</td>\n","      <td>망포동</td>\n","      <td>늘푸른벽산</td>\n","      <td>59.884</td>\n","      <td>488</td>\n","      <td>41117</td>\n","      <td>19</td>\n","      <td>37.239931</td>\n","      <td>127.060739</td>\n","      <td>경기 수원시 영통구 망포동 488</td>\n","    </tr>\n","    <tr>\n","      <th>4469</th>\n","      <td>49,700</td>\n","      <td>2002</td>\n","      <td>망포동</td>\n","      <td>망포현대2아이파크</td>\n","      <td>84.9945</td>\n","      <td>683</td>\n","      <td>41117</td>\n","      <td>2</td>\n","      <td>37.240117</td>\n","      <td>127.051035</td>\n","      <td>경기 수원시 영통구 망포동 683</td>\n","    </tr>\n","    <tr>\n","      <th>4470</th>\n","      <td>96,000</td>\n","      <td>2017</td>\n","      <td>망포동</td>\n","      <td>힐스테이트영통</td>\n","      <td>84.8897</td>\n","      <td>728</td>\n","      <td>41117</td>\n","      <td>21</td>\n","      <td>37.243348</td>\n","      <td>127.048732</td>\n","      <td>경기 수원시 영통구 망포동 728</td>\n","    </tr>\n","    <tr>\n","      <th>4471</th>\n","      <td>59,000</td>\n","      <td>2003</td>\n","      <td>망포동</td>\n","      <td>엘지동수원자이</td>\n","      <td>110.5997</td>\n","      <td>698</td>\n","      <td>41117</td>\n","      <td>1</td>\n","      <td>37.236696</td>\n","      <td>127.056533</td>\n","      <td>경기 수원시 영통구 망포동 698</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>4472 rows × 11 columns</p>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-1178b92d-d381-40c4-9c07-75ebd64590f9')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-1178b92d-d381-40c4-9c07-75ebd64590f9 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-1178b92d-d381-40c4-9c07-75ebd64590f9');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","<div id=\"df-0f6db107-ca5b-44f9-b4b5-40805a662c4e\">\n","  <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-0f6db107-ca5b-44f9-b4b5-40805a662c4e')\"\n","            title=\"Suggest charts\"\n","            style=\"display:none;\">\n","\n","<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","     width=\"24px\">\n","    <g>\n","        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n","    </g>\n","</svg>\n","  </button>\n","\n","<style>\n","  .colab-df-quickchart {\n","      --bg-color: #E8F0FE;\n","      --fill-color: #1967D2;\n","      --hover-bg-color: #E2EBFA;\n","      --hover-fill-color: #174EA6;\n","      --disabled-fill-color: #AAA;\n","      --disabled-bg-color: #DDD;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart {\n","      --bg-color: #3B4455;\n","      --fill-color: #D2E3FC;\n","      --hover-bg-color: #434B5C;\n","      --hover-fill-color: #FFFFFF;\n","      --disabled-bg-color: #3B4455;\n","      --disabled-fill-color: #666;\n","  }\n","\n","  .colab-df-quickchart {\n","    background-color: var(--bg-color);\n","    border: none;\n","    border-radius: 50%;\n","    cursor: pointer;\n","    display: none;\n","    fill: var(--fill-color);\n","    height: 32px;\n","    padding: 0;\n","    width: 32px;\n","  }\n","\n","  .colab-df-quickchart:hover {\n","    background-color: var(--hover-bg-color);\n","    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n","    fill: var(--button-hover-fill-color);\n","  }\n","\n","  .colab-df-quickchart-complete:disabled,\n","  .colab-df-quickchart-complete:disabled:hover {\n","    background-color: var(--disabled-bg-color);\n","    fill: var(--disabled-fill-color);\n","    box-shadow: none;\n","  }\n","\n","  .colab-df-spinner {\n","    border: 2px solid var(--fill-color);\n","    border-color: transparent;\n","    border-bottom-color: var(--fill-color);\n","    animation:\n","      spin 1s steps(1) infinite;\n","  }\n","\n","  @keyframes spin {\n","    0% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","      border-left-color: var(--fill-color);\n","    }\n","    20% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    30% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","      border-right-color: var(--fill-color);\n","    }\n","    40% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    60% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","    }\n","    80% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-bottom-color: var(--fill-color);\n","    }\n","    90% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","    }\n","  }\n","</style>\n","\n","  <script>\n","    async function quickchart(key) {\n","      const quickchartButtonEl =\n","        document.querySelector('#' + key + ' button');\n","      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n","      quickchartButtonEl.classList.add('colab-df-spinner');\n","      try {\n","        const charts = await google.colab.kernel.invokeFunction(\n","            'suggestCharts', [key], {});\n","      } catch (error) {\n","        console.error('Error during call to suggestCharts:', error);\n","      }\n","      quickchartButtonEl.classList.remove('colab-df-spinner');\n","      quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n","    }\n","    (() => {\n","      let quickchartButtonEl =\n","        document.querySelector('#df-0f6db107-ca5b-44f9-b4b5-40805a662c4e button');\n","      quickchartButtonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","    })();\n","  </script>\n","</div>\n","    </div>\n","  </div>\n"]},"metadata":{},"execution_count":25}],"source":["YeongtongDF"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"eIBVZXuzPh2U"},"outputs":[],"source":[]}],"metadata":{"colab":{"provenance":[]},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}